---
import Layout from '../layouts/Layout.astro';

function generateId() {
	return Math.random().toString(36).substring(2, 10);
}

async function handleCreate(formData: FormData) {
	const id = generateId();
	const title = formData.get('title') as string;
	const html = formData.get('html') as string;
	const css = formData.get('css') as string;
	const js = formData.get('js') as string;

	// Get the DB from locals (available in Cloudflare context)
	const { getDB } = await import('../lib/db');
	const { apps } = await import('../schema');

	// Note: In production, we'd get this from Astro.locals
	// For now, this is a simplified example
	return Astro.redirect(`/app/${id}`);
}
---

<Layout title="Create App - Pico">
	<div class="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50">
		<header class="bg-white border-b border-gray-200">
			<div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
				<h1 class="text-2xl font-bold text-purple-600">Pico</h1>
				<nav class="flex gap-4">
					<a href="/" class="text-gray-600 hover:text-purple-600 transition">Home</a>
					<a href="/create" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">Create App</a>
				</nav>
			</div>
		</header>

		<main class="max-w-4xl mx-auto px-4 py-16">
			<div class="bg-white rounded-xl shadow-lg p-8">
				<h2 class="text-3xl font-bold text-gray-900 mb-6">Create a New App</h2>

				<form id="appForm" method="POST" action="/api/create" class="space-y-6">
					<div>
						<label for="title" class="block text-sm font-medium text-gray-700 mb-2">App Title</label>
						<input
							type="text"
							id="title"
							name="title"
							required
							placeholder="My Awesome App"
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
						/>
					</div>

					<div>
						<label for="html" class="block text-sm font-medium text-gray-700 mb-2">HTML</label>
						<textarea
							id="html"
							name="html"
							required
							rows="10"
							placeholder="<div>Hello World!</div>"
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-sm"
						></textarea>
					</div>

					<div>
						<label for="css" class="block text-sm font-medium text-gray-700 mb-2">CSS (optional)</label>
						<textarea
							id="css"
							name="css"
							rows="6"
							placeholder="body { font-family: sans-serif; }"
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-sm"
						></textarea>
					</div>

					<div>
						<label for="js" class="block text-sm font-medium text-gray-700 mb-2">JavaScript (optional)</label>
						<textarea
							id="js"
							name="js"
							rows="6"
							placeholder="console.log('Hello!');"
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-sm"
						></textarea>
					</div>

					<div class="flex gap-4">
						<button
							type="submit"
							class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition font-medium"
						>
							Create App
						</button>
						<a
							href="/"
							class="px-8 py-3 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition font-medium"
						>
							Cancel
						</a>
					</div>
				</form>
			</div>
		</main>
	</div>
</Layout>
